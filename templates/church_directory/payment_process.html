{% extends 'church_directory/base.html' %}
{% load static %}

{% block title %}Payment Processing - Church Directory{% endblock %}

{% block content %}
<!-- Payment Header -->
<section class="bg-gray-50 py-12">
    <div class="container-width">
        <div class="text-center">
            <h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-4">
                Complete Your Payment
            </h1>
            <p class="text-lg text-gray-600">
                Secure payment processing for your Church Directory subscription
            </p>
        </div>
    </div>
</section>

<!-- Payment Content -->
<section class="section-padding">
    <div class="container-width max-w-4xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <!-- Left Column - Payment Form -->
            <div>
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-semibold text-gray-900 mb-6">Payment Information</h2>
                    
                    <!-- Stub Payment Form -->
                    <form method="post" id="payment-form">
                        {% csrf_token %}
                        
                        <!-- Payment Method Selection -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Payment Method</label>
                            <div class="space-y-3">
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="payment_method" value="card" class="mr-3" checked>
                                    <div class="flex items-center">
                                        <svg class="w-8 h-8 text-blue-600 mr-3" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M2 7a2 2 0 012-2h16a2 2 0 012 2v2H2V7zm0 4h20v6a2 2 0 01-2 2H4a2 2 0 01-2-2v-6zm5 3a1 1 0 000 2h6a1 1 0 100-2H7z"/>
                                        </svg>
                                        <span class="font-medium text-gray-900">Credit Card</span>
                                    </div>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Stub Credit Card Form -->
                        <div class="space-y-6">
                            <div>
                                <label for="card-number" class="block text-sm font-medium text-gray-700 mb-2">
                                    Card Number
                                </label>
                                <input 
                                    type="text" 
                                    id="card-number"
                                    placeholder="1234 5678 9012 3456"
                                    class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    maxlength="19"
                                >
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="expiry" class="block text-sm font-medium text-gray-700 mb-2">
                                        Expiry Date
                                    </label>
                                    <input 
                                        type="text" 
                                        id="expiry"
                                        placeholder="MM/YY"
                                        class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        maxlength="5"
                                    >
                                </div>
                                
                                <div>
                                    <label for="cvc" class="block text-sm font-medium text-gray-700 mb-2">
                                        CVC
                                    </label>
                                    <input 
                                        type="text" 
                                        id="cvc"
                                        placeholder="123"
                                        class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        maxlength="4"
                                    >
                                </div>
                            </div>
                            
                            <div>
                                <label for="name-on-card" class="block text-sm font-medium text-gray-700 mb-2">
                                    Name on Card
                                </label>
                                <input 
                                    type="text" 
                                    id="name-on-card"
                                    placeholder="John Smith"
                                    class="form-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                >
                            </div>
                        </div>
                        
                        <!-- Security Notice -->
                        <div class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <svg class="w-5 h-5 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                                </svg>
                                <span class="text-sm text-green-800 font-medium">Your payment is secured with 256-bit SSL encryption</span>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="mt-8">
                            <button type="submit" id="pay-button" class="btn-primary w-full">
                                Complete Payment - ${{ subscription.final_amount|floatformat:2 }}
                            </button>
                        </div>
                        
                        <!-- Demo Notice -->
                        <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 text-yellow-500 mr-2 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                                </svg>
                                <div>
                                    <p class="text-sm text-yellow-800 font-medium">Demo Mode</p>
                                    <p class="text-sm text-yellow-700">This is a demonstration. No real payment will be processed. Click "Complete Payment" to simulate a successful transaction.</p>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Right Column - Order Summary -->
            <div>
                <div class="bg-gray-50 rounded-xl p-8">
                    <h3 class="text-xl font-semibold text-gray-900 mb-6">Order Summary</h3>
                    
                    <!-- Subscription Details -->
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="text-gray-700">Plan</span>
                            <span class="font-medium text-gray-900">{{ subscription.pricing_tier.name }}</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-700">Billing</span>
                            <span class="font-medium text-gray-900 capitalize">{{ subscription.billing_period }}</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-700">Church</span>
                            <span class="font-medium text-gray-900">{{ subscription.church_name }}</span>
                        </div>
                        
                        <div class="flex justify-between">
                            <span class="text-gray-700">Contact</span>
                            <span class="font-medium text-gray-900">{{ subscription.contact_name }}</span>
                        </div>
                        
                        <hr class="border-gray-200">
                        
                        <!-- Pricing Breakdown -->
                        <div class="flex justify-between">
                            <span class="text-gray-700">Base price</span>
                            <span class="font-medium text-gray-900">
                                ${{ subscription.base_amount|floatformat:2 }}
                            </span>
                        </div>
                        
                        {% if subscription.discount_amount > 0 %}
                        <div class="flex justify-between text-green-600">
                            <span>Discount{% if subscription.coupon_used %} ({{ subscription.coupon_used.code }}){% endif %}</span>
                            <span>-${{ subscription.discount_amount|floatformat:2 }}</span>
                        </div>
                        {% endif %}
                        
                        <hr class="border-gray-200">
                        
                        <div class="flex justify-between text-xl font-semibold">
                            <span class="text-gray-900">Total</span>
                            <span class="text-gray-900">
                                ${{ subscription.final_amount|floatformat:2 }}
                            </span>
                        </div>
                        
                        <div class="text-sm text-gray-600 mt-4">
                            {% if subscription.billing_period == 'annual' %}
                            Billed annually on {{ subscription.created_at|date:"F j, Y" }}
                            {% else %}
                            Billed monthly starting {{ subscription.created_at|date:"F j, Y" }}
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Features -->
                    <div class="mt-8">
                        <h4 class="text-sm font-semibold text-gray-900 mb-3">What You Get:</h4>
                        <ul class="space-y-2">
                            {% for feature in subscription.pricing_tier.features|slice:":6" %}
                            <li class="flex items-start text-sm text-gray-700">
                                <svg class="w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                {{ feature }}
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <!-- Support -->
                    <div class="mt-8 p-4 bg-white rounded-lg">
                        <div class="flex items-center mb-2">
                            <svg class="w-5 h-5 text-blue-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"></path>
                            </svg>
                            <span class="text-sm text-gray-900 font-medium">Questions?</span>
                        </div>
                        <p class="text-sm text-gray-600">
                            Contact us at <a href="mailto:support@verionlabs.com" class="text-blue-600 hover:text-blue-800">support@verionlabs.com</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Format card number input
    const cardNumber = document.getElementById('card-number');
    cardNumber.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        let formattedValue = value.replace(/(\d{4})(?=\d)/g, '$1 ');
        if (formattedValue !== e.target.value) {
            e.target.value = formattedValue;
        }
    });
    
    // Format expiry date input
    const expiry = document.getElementById('expiry');
    expiry.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 2) {
            value = value.substring(0, 2) + '/' + value.substring(2, 4);
        }
        e.target.value = value;
    });
    
    // Format CVC input (numbers only)
    const cvc = document.getElementById('cvc');
    cvc.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\D/g, '');
    });
    
    // Handle form submission
    const paymentForm = document.getElementById('payment-form');
    const payButton = document.getElementById('pay-button');
    
    paymentForm.addEventListener('submit', function(e) {
        // Show loading state
        payButton.disabled = true;
        payButton.innerHTML = 'Processing Payment...';
        
        // In a real implementation, you would integrate with Stripe here
        // For now, just submit the form normally
    });
});
</script>
{% endblock %}